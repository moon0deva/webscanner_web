{% extends "base.html" %}
{% block title %}Network Security Tools - Home{% endblock %}
{% block body_class %}gradient-bg{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="row mb-5">
    <div class="col-12 text-center py-4">
        <h1 class="display-4 fw-bold text-dark mb-3">
            üõ°Ô∏è Network Security Tools Platform
        </h1>
        <p class="lead text-muted mb-4">Professional network reconnaissance, port scanning and vulnerability analysis</p>
        <div class="d-flex justify-content-center gap-3 flex-wrap">
            <a href="/scanner" class="btn btn-primary btn-lg px-4">
                üîç Launch Scanner
            </a>
            <a href="templates/history" class="btn btn-outline-secondary btn-lg px-4">
                üìä View History
            </a>
        </div>
    </div>
</div>

<!-- Feature Cards -->
<div class="row g-4 mb-5">
    <div class="col-md-4">
        <div class="card h-100 shadow-sm feature-card">
            <div class="card-body text-center p-4">
                <div class="feature-icon mb-3">‚ö°</div>
                <h5 class="card-title fw-bold">Quick Scan</h5>
                <p class="card-text text-muted">Rapidly scan the most common ports in 10‚Äì20 seconds. Ideal for fast reconnaissance without authentication.</p>
                <a href="templates/scanner" class="btn btn-sm btn-outline-primary mt-2">Start Quick Scan</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100 shadow-sm feature-card">
            <div class="card-body text-center p-4">
                <div class="feature-icon mb-3">üî•</div>
                <h5 class="card-title fw-bold">Deep Scan</h5>
                <p class="card-text text-muted">Full port scan across all 65,535 ports with service fingerprinting, OS detection and version analysis.</p>
                <a href="templates/scanner" class="btn btn-sm btn-outline-primary mt-2">Start Deep Scan</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100 shadow-sm feature-card">
            <div class="card-body text-center p-4">
                <div class="feature-icon mb-3">üìä</div>
                <h5 class="card-title fw-bold">Scan History</h5>
                <p class="card-text text-muted">View all past scans, filter by target or type, and export detailed reports as PDF or JSON.</p>
                <a href="templates/history" class="btn btn-sm btn-outline-primary mt-2">View History</a>
            </div>
        </div>
    </div>
</div>

<!-- Stats Bar -->
<div class="row mb-5">
    <div class="col-12">
        <div class="card shadow-sm stats-bar">
            <div class="card-body py-3">
                <div class="row text-center g-3" id="statsRow">
                    <div class="col-6 col-md-3">
                        <div class="stat-number" id="statTotal">‚Äì</div>
                        <div class="stat-label">Total Scans</div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-number" id="statPorts">‚Äì</div>
                        <div class="stat-label">Ports Discovered</div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-number" id="statRecent">‚Äì</div>
                        <div class="stat-label">Scans This Week</div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-number" id="statAvg">‚Äì</div>
                        <div class="stat-label">Avg Duration (s)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- News Feed -->
<div class="row">
    <div class="col-12">
        <h4 class="fw-bold mb-3">üì∞ Latest Cybersecurity News</h4>
        <div id="newsFeed" class="row g-3">
            <div class="col-12 text-center py-4 text-muted">
                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                Loading news...
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Load statistics
async function loadStats() {
    try {
        const res  = await fetch('/api/statistics');
        const data = await res.json();
        document.getElementById('statTotal').textContent  = data.total_scans   ?? 0;
        document.getElementById('statPorts').textContent  = data.total_ports   ?? 0;
        document.getElementById('statRecent').textContent = data.recent_scans  ?? 0;
        document.getElementById('statAvg').textContent    = data.avg_duration  ?? 0;
    } catch(e) { console.error('Stats error:', e); }
}

// Load cybersecurity news via RSS-to-JSON proxy
async function loadNews() {
    const feeds = [
        'https://feeds.feedburner.com/TheHackersNews',
        'https://www.bleepingcomputer.com/feed/',
        'https://krebsonsecurity.com/feed/',
    ];
    const proxy = 'https://api.rss2json.com/v1/api.json?rss_url=';
    const container = document.getElementById('newsFeed');

    try {
        const res  = await fetch(proxy + encodeURIComponent(feeds[0]));
        const data = await res.json();
        const items = (data.items || []).slice(0, 6);
        if (!items.length) throw new Error('No items');

        container.innerHTML = items.map(item => `
            <div class="col-md-4">
                <div class="card news-card h-100 shadow-sm">
                    <div class="card-body">
                        <span class="badge bg-danger mb-2">Security News</span>
                        <h6 class="card-title fw-bold" style="font-size:0.9rem;">
                            <a href="${item.link}" target="_blank" class="text-decoration-none text-dark">
                                ${item.title.substring(0, 80)}${item.title.length > 80 ? '...' : ''}
                            </a>
                        </h6>
                        <p class="card-text text-muted small">
                            ${(item.description || '').replace(/<[^>]*>/g, '').substring(0, 100)}...
                        </p>
                        <small class="text-muted">${new Date(item.pubDate).toLocaleDateString()}</small>
                    </div>
                </div>
            </div>
        `).join('');
    } catch(e) {
        container.innerHTML = `
            <div class="col-12">
                <div class="alert alert-info">
                    üì∞ News feed temporarily unavailable.
                    <a href="https://thehackernews.com" target="_blank" class="alert-link ms-2">Visit The Hacker News ‚Üí</a>
                </div>
            </div>`;
    }
}

document.addEventListener('DOMContentLoaded', () => {
    loadStats();
    loadNews();
});
</script>
{% endblock %}
